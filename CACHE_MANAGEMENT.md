# Vite ç¼“å­˜ç®¡ç†æŒ‡å—

æœ¬é¡¹ç›®å·²é›†æˆäº†å®Œæ•´çš„ Vite ç¼“å­˜ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œç”¨äºè§£å†³ `node_modules/.vite` ç¼“å­˜è¿‡æœŸå¯¼è‡´å‰ç«¯æ‹‰å–èµ„æºæŠ¥ 504 é”™è¯¯çš„é—®é¢˜ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ¨èä½¿ç”¨æ–¹å¼

```bash
# æ™ºèƒ½å¼€å‘æ¨¡å¼ï¼ˆæ¨èï¼‰- è‡ªåŠ¨æ£€æµ‹ç¼“å­˜å¥åº·çŠ¶æ€
pnpm run dev:smart

# æˆ–è€…å¼ºåˆ¶æ¸…ç†ç¼“å­˜åå¯åŠ¨
pnpm run dev:clean
```

### æ‰‹åŠ¨ç¼“å­˜ç®¡ç†

```bash
# æ¸…ç†æ‰€æœ‰ç¼“å­˜
pnpm run clear-cache

# åªæ¸…ç† Vite ç¼“å­˜
pnpm run clear-cache:vite

# åªæ¸…ç†åŒ…ç®¡ç†å™¨ç¼“å­˜
pnpm run clear-cache:pm

# æŸ¥çœ‹ç¼“å­˜æ¸…ç†å¸®åŠ©
pnpm run clear-cache:help
```

## ğŸ“‹ å¯ç”¨è„šæœ¬

| è„šæœ¬å‘½ä»¤ | æè¿° |
|---------|------|
| `pnpm run dev:smart` | æ™ºèƒ½å¼€å‘æ¨¡å¼ï¼Œè‡ªåŠ¨æ£€æµ‹ç¼“å­˜å¥åº·çŠ¶æ€å¹¶åœ¨éœ€è¦æ—¶æ¸…ç† |
| `pnpm run dev:clean` | å¼ºåˆ¶æ¸…ç†ç¼“å­˜åå¯åŠ¨å¼€å‘æœåŠ¡å™¨ |
| `pnpm run build:clean` | å¼ºåˆ¶æ¸…ç†ç¼“å­˜åæ„å»ºé¡¹ç›® |
| `pnpm run clear-cache` | æ¸…ç†æ‰€æœ‰ç¼“å­˜ï¼ˆVite + åŒ…ç®¡ç†å™¨ï¼‰ |
| `pnpm run clear-cache:vite` | åªæ¸…ç† Vite ç¼“å­˜ |
| `pnpm run clear-cache:pm` | åªæ¸…ç†åŒ…ç®¡ç†å™¨ç¼“å­˜ |
| `pnpm run clear-cache:help` | æ˜¾ç¤ºç¼“å­˜æ¸…ç†å¸®åŠ©ä¿¡æ¯ |

## ğŸ”§ é…ç½®è¯´æ˜

### Vite é…ç½®ä¼˜åŒ–

é¡¹ç›®ä¸­çš„ä¸¤ä¸ª Vite é…ç½®æ–‡ä»¶å·²ç»ä¼˜åŒ–ï¼š

- `src/renderer/main/vite.config.ts` - ä¸»æ¸²æŸ“å™¨é…ç½®
- `src/renderer/floating/vite.config.ts` - æµ®åŠ¨çª—å£é…ç½®

ä¸»è¦ä¼˜åŒ–å†…å®¹ï¼š

1. **ç‹¬ç«‹ç¼“å­˜ç›®å½•**ï¼šä¸ºæ¯ä¸ªæ¸²æŸ“å™¨è®¾ç½®ç‹¬ç«‹çš„ç¼“å­˜ç›®å½•
2. **å¼ºåˆ¶é‡æ–°æ„å»º**ï¼šé€šè¿‡ç¯å¢ƒå˜é‡ `CLEAR_CACHE=true` æ§åˆ¶
3. **ä¾èµ–é¢„æ„å»º**ï¼šæ˜ç¡®æŒ‡å®šéœ€è¦é¢„æ„å»ºçš„ä¾èµ–
4. **ç¼“å­˜ç­–ç•¥**ï¼šä¼˜åŒ–ç¼“å­˜å­˜å‚¨å’Œè¯»å–ç­–ç•¥

### ç¯å¢ƒå˜é‡

- `CLEAR_CACHE=true` - å¼ºåˆ¶æ¸…ç†ç¼“å­˜å¹¶é‡æ–°æ„å»ºä¾èµ–

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. å‰ç«¯èµ„æº 504 é”™è¯¯

**ç—‡çŠ¶**ï¼šå¼€å‘æœåŠ¡å™¨å¯åŠ¨åï¼Œæµè§ˆå™¨åŠ è½½èµ„æºæ—¶å‡ºç° 504 é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ¡ˆ 1ï¼šä½¿ç”¨æ™ºèƒ½å¼€å‘æ¨¡å¼
pnpm run dev:smart

# æ–¹æ¡ˆ 2ï¼šæ‰‹åŠ¨æ¸…ç†ç¼“å­˜
pnpm run clear-cache && pnpm run dev

# æ–¹æ¡ˆ 3ï¼šå¼ºåˆ¶æ¸…ç†ç¼“å­˜
CLEAR_CACHE=true pnpm run dev
```

#### 2. ç¼“å­˜è¿‡æœŸè­¦å‘Š

**ç—‡çŠ¶**ï¼šå¯åŠ¨æ—¶çœ‹åˆ°ç¼“å­˜è¿‡æœŸè­¦å‘Š

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ™ºèƒ½å¼€å‘æ¨¡å¼ä¼šè‡ªåŠ¨å¤„ç†
pnpm run dev:smart

# æˆ–æ‰‹åŠ¨æ¸…ç†
pnpm run clear-cache:vite
```

#### 3. ä¾èµ–æ›´æ–°åçš„é—®é¢˜

**ç—‡çŠ¶**ï¼šæ›´æ–°ä¾èµ–åå‡ºç°æ¨¡å—è§£æé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…ç†æ‰€æœ‰ç¼“å­˜
pnpm run clear-cache

# é‡æ–°å®‰è£…ä¾èµ–
pnpm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm run dev
```

### é«˜çº§æ•…éšœæ’é™¤

#### æ‰‹åŠ¨æ¸…ç†ç‰¹å®šç¼“å­˜

```bash
# åªæ¸…ç†ä¸»æ¸²æŸ“å™¨ç¼“å­˜
rm -rf node_modules/.vite/main

# åªæ¸…ç†æµ®åŠ¨çª—å£ç¼“å­˜
rm -rf node_modules/.vite/floating

# æ¸…ç†æ‰€æœ‰ Vite ç¼“å­˜
rm -rf node_modules/.vite

# æ¸…ç†æ„å»ºè¾“å‡º
rm -rf dist
```

#### å¼ºåˆ¶é‡æ–°æ„å»º

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡å¼ºåˆ¶é‡æ–°æ„å»º
export CLEAR_CACHE=true
pnpm run dev

# æˆ–è€…ä¸€æ¬¡æ€§è®¾ç½®
CLEAR_CACHE=true pnpm run dev
```

## ğŸ” ç¼“å­˜å¥åº·æ£€æŸ¥

æ™ºèƒ½å¼€å‘æ¨¡å¼ (`pnpm run dev:smart`) ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š

1. **ç¼“å­˜ç›®å½•å­˜åœ¨æ€§æ£€æŸ¥**
2. **ç¼“å­˜æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥**
3. **ç¼“å­˜å¹´é¾„æ£€æŸ¥**ï¼ˆè¶…è¿‡ 7 å¤©è‡ªåŠ¨æ¸…ç†ï¼‰
4. **ä¾èµ–å˜æ›´æ£€æŸ¥**

## ğŸ“ ç¼“å­˜ç›®å½•ç»“æ„

```
node_modules/
â””â”€â”€ .vite/
    â”œâ”€â”€ main/           # ä¸»æ¸²æŸ“å™¨ç¼“å­˜
    â”‚   â””â”€â”€ deps/       # ä¾èµ–é¢„æ„å»ºç¼“å­˜
    â””â”€â”€ floating/       # æµ®åŠ¨çª—å£ç¼“å­˜
        â””â”€â”€ deps/       # ä¾èµ–é¢„æ„å»ºç¼“å­˜
```

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æ—¥å¸¸å¼€å‘**ï¼šä½¿ç”¨ `pnpm run dev:smart`ï¼Œè®©ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ç¼“å­˜
2. **é‡åˆ°é—®é¢˜**ï¼šé¦–å…ˆå°è¯• `pnpm run dev:clean`
3. **ä¾èµ–æ›´æ–°å**ï¼šè¿è¡Œ `pnpm run clear-cache` æ¸…ç†æ‰€æœ‰ç¼“å­˜
4. **CI/CD ç¯å¢ƒ**ï¼šä½¿ç”¨ `pnpm run build:clean` ç¡®ä¿å¹²å‡€æ„å»º
5. **å®šæœŸç»´æŠ¤**ï¼šæ¯å‘¨è¿è¡Œä¸€æ¬¡ `pnpm run clear-cache` æ¸…ç†è¿‡æœŸç¼“å­˜

## ğŸ”„ è‡ªåŠ¨åŒ–å»ºè®®

å¯ä»¥åœ¨ `.gitignore` ä¸­ç¡®ä¿ç¼“å­˜ç›®å½•è¢«å¿½ç•¥ï¼š

```gitignore
# Vite ç¼“å­˜
node_modules/.vite/

# æ„å»ºè¾“å‡º
dist/
```

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°ç¼“å­˜ç›¸å…³é—®é¢˜ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. è¿è¡Œ `pnpm run clear-cache:help` æŸ¥çœ‹è¯¦ç»†é€‰é¡¹
3. æ£€æŸ¥æ§åˆ¶å°è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯
4. å°è¯•å®Œå…¨æ¸…ç†åé‡æ–°å¼€å§‹ï¼š
   ```bash
   pnpm run clear-cache
   rm -rf node_modules
   pnpm install
   pnpm run dev:smart
   ```